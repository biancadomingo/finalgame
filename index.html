<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KawaiiKamera ‚ô™ Photobooth</title>

  <!-- Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Cute Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --kawaii-pink: #ffb6e6;
      --kawaii-hot-pink: #ff6fb7;
      --kawaii-lilac: #c7b7ff;
      --kawaii-mint: #b9f3e4;
      --kawaii-bg: #fff5fb;
      --kawaii-dark: #3b2b40;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Fredoka", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #ffe6f5, #fdf1ff 40%, #fff);
      color: var(--kawaii-dark);
    }

    .kawaii-shell {
      max-width: 1100px;
      margin: 2rem auto;
      padding: 1.5rem;
    }

    .kawaii-card {
      background: linear-gradient(
        135deg,
        rgba(255, 182, 230, 0.8),
        rgba(185, 243, 228, 0.8)
      );
      border-radius: 1.75rem;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.1);
      padding: 1.75rem;
      border: 2px solid rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
    }

    .kawaii-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .kawaii-header h1 {
      font-weight: 700;
      font-size: 2.4rem;
      letter-spacing: 1px;
    }

    .kawaii-header .ascii {
      font-size: 1.2rem;
      line-height: 1.2;
      white-space: pre-line;
    }

    .kawaii-pill {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      background-color: rgba(255, 255, 255, 0.85);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .camera-wrapper {
      position: relative;
      border-radius: 1.25rem;
      overflow: hidden;
      border: 3px solid rgba(255, 255, 255, 0.9);
      background: #000;
      aspect-ratio: 4 / 3;
    }

    video#camera {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1); /* mirror selfie style */
    }

    canvas#photoCanvas,
    canvas#stripCanvas {
      display: none;
    }

    .preview-frame {
      margin-top: 1rem;
      border-radius: 1.25rem;
      background: rgba(255, 255, 255, 0.8);
      padding: 0.75rem;
      text-align: center;
      min-height: 120px;
    }

    .preview-frame img {
      max-width: 100%;
      border-radius: 1rem;
      border: 2px dashed var(--kawaii-hot-pink);
    }

    .kawaii-btn {
      border-radius: 999px;
      border: none;
      font-weight: 600;
      padding: 0.6rem 1.3rem;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      transition: transform 0.1s ease, box-shadow 0.1s ease,
        background-color 0.2s ease;
    }

    .kawaii-btn-primary {
      background: var(--kawaii-hot-pink);
      color: #fff;
      box-shadow: 0 8px 15px rgba(255, 111, 183, 0.4);
    }

    .kawaii-btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(255, 111, 183, 0.6);
    }

    .kawaii-btn-ghost {
      background: rgba(255, 255, 255, 0.9);
      color: var(--kawaii-dark);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);
    }

    .kawaii-btn-ghost:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
    }

    .filter-pill {
      cursor: pointer;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: 1px dashed rgba(255, 255, 255, 0.9);
      background: rgba(255, 255, 255, 0.75);
      font-size: 0.8rem;
      margin: 0.2rem;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      white-space: nowrap;
    }

    .filter-pill.active {
      background: var(--kawaii-lilac);
      border-style: solid;
      border-color: var(--kawaii-dark);
      font-weight: 600;
    }

    .sidebar-kawaii {
      border-radius: 1.5rem;
      padding: 1rem 1.25rem;
      background: rgba(255, 255, 255, 0.9);
      border: 2px dashed rgba(255, 182, 230, 0.9);
      font-size: 0.9rem;
    }

    .sidebar-kawaii h2 {
      font-size: 1.25rem;
      margin-bottom: 0.4rem;
    }

    .sidebar-kawaii ul {
      padding-left: 1.1rem;
      margin: 0.35rem 0 0;
      list-style: "‚ô° ";
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      font-size: 0.8rem;
      background: rgba(255, 255, 255, 0.8);
      margin-top: 0.5rem;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #aaa;
    }

    .status-dot.live {
      background: #ff4b8b;
      box-shadow: 0 0 10px rgba(255, 75, 139, 0.8);
    }

    .link-muted {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    @media (max-width: 767px) {
      .kawaii-card {
        padding: 1.25rem;
      }

      .kawaii-header h1 {
        font-size: 1.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="kawaii-shell">
    <div class="kawaii-header">
      <div class="ascii">
        Hiii ! :3<br />
        ‚ï≠‚îÄ‚îÄ‚îÄ‡º∫‚ô°‡ºª‚îÄ‚îÄ‚îÄ‚ïÆ
      </div>
      <h1>KawaiiKamera ‚ô™</h1>
      <div class="kawaii-pill">‚ÄßÀö‚Çä‚äπ Take cute selfies with fun effects ‚äπ‚ÇäÀö‚Äß</div>
    </div>

    <div class="kawaii-card">
      <div class="row g-4">
        <!-- LEFT: Camera + Preview -->
        <div class="col-md-7">
          <div class="camera-wrapper mb-2">
            <video id="camera" autoplay playsinline></video>
          </div>

          <div class="d-flex flex-wrap gap-2 mb-3">
            <button id="startCameraBtn" class="kawaii-btn kawaii-btn-primary">
              üéÄ Use my camera
            </button>
            <button id="takePhotoBtn" class="kawaii-btn kawaii-btn-ghost" disabled>
              üì∏ Take a photo
            </button>
            <button id="takeStripBtn" class="kawaii-btn kawaii-btn-ghost" disabled>
              üéûÔ∏è Take 4 photos
            </button>
            <a
              id="downloadLink"
              class="kawaii-btn kawaii-btn-primary ms-auto disabled"
              href="#"
              download="kawaii-photo.png"
              aria-disabled="true"
            >
              ‚¨áÔ∏è Save photo
            </a>
          </div>

          <div class="status-badge" id="statusBadge">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Camera not started yet‚Ä¶</span>
          </div>

          <div class="preview-frame mt-3">
            <p class="mb-1 small">Preview ‚ô™</p>
            <img id="previewImage" alt="Your kawaii photo will appear here" />
          </div>

          <!-- Hidden canvases for capture -->
          <canvas id="photoCanvas"></canvas>
          <canvas id="stripCanvas"></canvas>
        </div>

        <!-- RIGHT: Filters + Info -->
        <div class="col-md-5 d-flex flex-column gap-3">
          <div class="sidebar-kawaii">
            <h2>Filters ‚ô°</h2>
            <p class="mb-2 small">
              Click a filter, then snap your selfie~
            </p>
            <div id="filtersContainer">
              <!-- Filter pills created by JS OR use this static list: -->
              <span class="filter-pill active" data-filter="none">
                ‚úß Normal
              </span>
              <span class="filter-pill" data-filter="kawaii">
                ‚ô° Soft Pink
              </span>
              <span class="filter-pill" data-filter="mono">
                ‚òæ B&W
              </span>
              <span class="filter-pill" data-filter="glow">
                ‚ú® Glow
              </span>
              <span class="filter-pill" data-filter="vintage">
                üìº Vintage
              </span>
              <span class="filter-pill" data-filter="cool">
                ‚ùÑÔ∏è Cool
              </span>
              <span class="filter-pill" data-filter="dramatic">
                ‚ö° Dramatic
              </span>
            </div>
          </div>

          <div class="sidebar-kawaii">
            <h2>How it works ‚ô™</h2>
            <ul>
              <li>Click <b>‚ÄúUse my camera‚Äù</b> and allow access.</li>
              <li>Pick a <b>filter</b> you like.</li>
              <li>Hit <b>‚ÄúTake a photo‚Äù</b> or <b>‚ÄúTake 4 photos‚Äù</b>.</li>
              <li>Press <b>‚ÄúSave photo‚Äù</b> to download.</li>
            </ul>
            <p class="mt-2 link-muted">
              Tip: This works best over HTTPS or on <code>localhost</code>.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (optional for layout & buttons, not required for core logic) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const video = document.getElementById("camera");
    const startCameraBtn = document.getElementById("startCameraBtn");
    const takePhotoBtn = document.getElementById("takePhotoBtn");
    const takeStripBtn = document.getElementById("takeStripBtn");
    const downloadLink = document.getElementById("downloadLink");
    const previewImage = document.getElementById("previewImage");
    const photoCanvas = document.getElementById("photoCanvas");
    const stripCanvas = document.getElementById("stripCanvas");
    const filterPills = document.querySelectorAll(".filter-pill");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");

    let currentStream = null;
    let currentFilterKey = "none";
    let lastPhotoDataUrl = null;

    const FILTER_MAP = {
      none: "none",
      kawaii: "contrast(1.05) saturate(1.4) hue-rotate(-10deg) brightness(1.08)",
      mono: "grayscale(1) contrast(1.2)",
      glow: "brightness(1.1) contrast(1.1) saturate(1.3) drop-shadow(0 0 10px rgba(255,255,255,0.9))",
      vintage: "sepia(0.5) contrast(1.1) saturate(1.2)",
      cool: "contrast(1.1) saturate(1.1) hue-rotate(15deg)",
      dramatic: "contrast(1.4) saturate(1.3) brightness(0.95)"
    };

    function setStatus(message, live = false) {
      statusText.textContent = message;
      if (live) {
        statusDot.classList.add("live");
      } else {
        statusDot.classList.remove("live");
      }
    }

    function setFilter(key) {
      currentFilterKey = key;
      const cssFilter = FILTER_MAP[key] || "none";
      video.style.filter = cssFilter;

      filterPills.forEach((pill) => {
        pill.classList.toggle("active", pill.dataset.filter === key);
      });
    }

    async function startCamera() {
      try {
        if (currentStream) {
          currentStream.getTracks().forEach((track) => track.stop());
        }

        const stream = await navigator.mediaDevices.getUserMedia({
          video: true,
          audio: false
        });
        currentStream = stream;
        video.srcObject = stream;

        takePhotoBtn.disabled = false;
        takeStripBtn.disabled = false;
        setStatus("Camera is live ‚ô™ Say cheese!", true);
      } catch (err) {
        console.error(err);
        setStatus("Could not access your camera. Check permissions.", false);
        alert(
          "Oops! I couldn't access your camera.\nPlease check browser permissions and try again."
        );
      }
    }

    function ensureVideoReady() {
      if (!video.videoWidth || !video.videoHeight) {
        // Not ready yet
        return false;
      }
      return true;
    }

    function applyCanvasFilter(ctx) {
      const cssFilter = FILTER_MAP[currentFilterKey] || "none";
      // Canvas 2D filter is compatible with CSS filter syntax for most basic filters
      ctx.filter = cssFilter;
    }

    function captureSinglePhoto() {
      if (!ensureVideoReady()) {
        setStatus("Camera is still loading‚Ä¶ try again in a second.", false);
        return;
      }

      const width = video.videoWidth;
      const height = video.videoHeight;

      photoCanvas.width = width;
      photoCanvas.height = height;

      const ctx = photoCanvas.getContext("2d");
      applyCanvasFilter(ctx);

      // Mirror horizontally so it matches on-screen preview
      ctx.save();
      ctx.translate(width, 0);
      ctx.scale(-1, 1);
      ctx.drawImage(video, 0, 0, width, height);
      ctx.restore();

      lastPhotoDataUrl = photoCanvas.toDataURL("image/png");
      previewImage.src = lastPhotoDataUrl;

      downloadLink.href = lastPhotoDataUrl;
      downloadLink.classList.remove("disabled");
      downloadLink.setAttribute("aria-disabled", "false");
    }

    function capturePhotoStrip() {
      if (!ensureVideoReady()) {
        setStatus("Camera is still loading‚Ä¶ try again in a second.", false);
        return;
      }

      const singleW = video.videoWidth;
      const singleH = video.videoHeight;

      const cols = 2;
      const rows = 2;

      stripCanvas.width = singleW * cols;
      stripCanvas.height = singleH * rows;

      const ctx = stripCanvas.getContext("2d");
      applyCanvasFilter(ctx);

      let shotsTaken = 0;
      const positions = [
        [0, 0],
        [singleW, 0],
        [0, singleH],
        [singleW, singleH]
      ];

      setStatus("Taking 4 photos‚Ä¶ pose quickly! ‚ô™", true);

      const intervalId = setInterval(() => {
        const [x, y] = positions[shotsTaken];

        // Mirror each frame like preview
        ctx.save();
        ctx.translate(x + singleW, y);
        ctx.scale(-1, 1);
        ctx.drawImage(video, 0, 0, singleW, singleH);
        ctx.restore();

        shotsTaken++;

        if (shotsTaken >= 4) {
          clearInterval(intervalId);
          lastPhotoDataUrl = stripCanvas.toDataURL("image/png");
          previewImage.src = lastPhotoDataUrl;
          downloadLink.href = lastPhotoDataUrl;
          downloadLink.download = "kawaii-strip.png";
          downloadLink.classList.remove("disabled");
          downloadLink.setAttribute("aria-disabled", "false");
          setStatus("4-photo strip ready! Save it below ‚ô°", true);
        }
      }, 500); // 0.5s between shots
    }

    // Event listeners
    startCameraBtn.addEventListener("click", startCamera);

    takePhotoBtn.addEventListener("click", () => {
      captureSinglePhoto();
    });

    takeStripBtn.addEventListener("click", () => {
      capturePhotoStrip();
    });

    filterPills.forEach((pill) => {
      pill.addEventListener("click", () => {
        const key = pill.dataset.filter;
        setFilter(key);
      });
    });

    // Initial UI state
    setFilter("none");
  </script>
</body>
</html>
